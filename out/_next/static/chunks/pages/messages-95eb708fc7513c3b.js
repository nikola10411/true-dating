(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5313],{35365:function(e,t,r){"use strict";var a=r(88169),i=r(85893);t.Z=(0,a.Z)((0,i.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send")},89959:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/messages",function(){return r(98314)}])},98314:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return j}});var a=r(85893),i=r(99226),n=r(46574),o=r(98456),s=r(15861),l=r(61903),c=r(83321),d=r(13486),u=r(60075),m=r(21640),h=r(36100),p=r(67294);r(17866);var g=r(11163),f=r(35365);let x=e=>{let{id:t,...r}=e,a=(0,h.JU)(u.RZ,"messages",t);(0,h.r7)(a,r)},v=(e,t)=>{e&&t&&e.forEach(e=>{e.read||e.to!==t.email||(e.read=!0,x({id:e.id,...e}))})};function j(e){let{user:t}=(0,m.a)(),r=(0,g.useRouter)(),x=(0,p.useRef)(null),[j,Z]=(0,p.useState)(null);(0,p.useEffect)(()=>{let e=async()=>{console.log(r.query);let e=JSON.parse(r.query.data);console.log(e),Z(e);let a=(0,h.hJ)(u.RZ,"messages"),i=(0,h.IO)(a,(0,h.ar)("room","in",["".concat(e.email,"+").concat(t.email),"".concat(t.email,"+").concat(e.email)]),(0,h.Xo)("createdAt"),(0,h.vh)(100));R(!0);let n=await (0,h.PL)(i),o=[];n.forEach(e=>{o.push(e.data())}),b(o),R(!1)};e()},[r.query]);let[y,b]=(0,p.useState)([]),[w,R]=(0,p.useState)(!0);(0,p.useEffect)(()=>{console.log(j),j&&j.email},[j]),(0,p.useEffect)(()=>{let e=x.current;!w&&y.length&&(null==e?void 0:e.scrollTop)===0&&(null==e||e.scrollTo({top:null==e?void 0:e.scrollHeight,behavior:"smooth"}),v(y,t))},[w,y.length]);let _=async e=>{var r,a,i;e.preventDefault();let n=e.target.messageInput,{email:o,photoURL:s,firstName:l,lastName:c}=t,d=u.ZP.firestore.FieldValue.serverTimestamp(),m={user:{firstName:l,lastName:c,email:o,photoURL:s},createdAt:d,text:n.value,room:(null===(r=y[0])||void 0===r?void 0:r.room)||"".concat(t.email,"+").concat(state.email),from:t.email,to:state.email,toName:state.firstName,read:!1,members:[t.email,state.email]};n.value="",await messagesRef.add(m),null===(a=x.current)||void 0===a||a.scrollTo({top:null===(i=x.current)||void 0===i?void 0:i.scrollHeight,behavior:"smooth"})};return j?(0,a.jsx)(i.Z,{py:6,children:(0,a.jsx)(n.Z,{children:(0,a.jsxs)(i.Z,{sx:e=>({borderRadius:e.shape.borderRadius,width:"100%"}),children:[(0,a.jsxs)(i.Z,{display:"flex",alignItems:"center",sx:e=>({paddingBottom:e.spacing(1),borderBottom:"1px solid ".concat(e.palette.divider)}),children:[(0,a.jsx)(i.Z,{style:{backgroundImage:"url(".concat(j.photoURL||("M"===j.gender?"https://media.istockphoto.com/vectors/default-placeholder-man-vector-id844000458?":"https://st3.depositphotos.com/9998432/13335/v/600/depositphotos_133351974-stock-illustration-default-placeholder-woman.jpg"),")")},sx:e=>({width:e.spacing(6),height:e.spacing(6),borderRadius:e.spacing(3),backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",marginRight:e.spacing(2)})}),(0,a.jsx)(i.Z,{children:j.firstName})]}),(0,a.jsxs)(i.Z,{sx:e=>({overflowY:"auto",maxHeight:"60vh",minHeight:"40vh"}),pt:1,ref:x,children:[w?(0,a.jsx)(i.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"inherit",children:(0,a.jsx)(o.Z,{color:"primary"})}):y.map(e=>(0,a.jsx)(i.Z,{sx:r=>({width:"fit-content",maxWidth:"70%",padding:r.spacing(1),borderRadius:r.shape.borderRadius,marginTop:r.spacing(.2),display:"flex",flexDirection:"column",backgroundColor:e.user.email===t.email?e=>{let{matchType:t}=e;return 1===t?r.palette.primary.main:d.Z[500]}:r.palette.grey[700],color:e.user.email===t.email?r.palette.primary.contrastText:r.palette.secondary.contrastText,marginLeft:e.user.email===t.email?"auto":"unset"}),children:(0,a.jsx)(i.Z,{sx:e=>({overflowWrap:"break-word"}),children:e.text})},e.id)),!w&&0===y.length&&(0,a.jsx)(i.Z,{textAlign:"center",display:"flex",minHeight:"inherit",justifyContent:"center",alignItems:"center",children:(0,a.jsxs)(s.Z,{variant:"body1",children:["This is your first conversation with ",(0,a.jsx)("br",{})," ",(0,a.jsx)("strong",{children:j.firstName})]})})]}),(0,a.jsx)(i.Z,{mt:2,children:(0,a.jsxs)("form",{onSubmit:_,children:[(0,a.jsx)(l.Z,{name:"messageInput",variant:"outlined",fullWidth:!0,placeholder:"Enter message",sx:e=>({"& .MuiOutlinedInput-root:focus .MuiOutlinedInput-notchedOutline":{borderColor:t=>{let{matchType:r}=t;return 1===r?e.palette.primary.main:d.Z[500]}}}),required:!0}),(0,a.jsx)(i.Z,{py:1}),(0,a.jsx)(c.Z,{type:"submit",fullWidth:!0,color:"primary",variant:"contained",endIcon:(0,a.jsx)(f.Z,{}),children:"Send"})]})})]})})}):(0,a.jsx)(i.Z,{})}}},function(e){e.O(0,[1903,9774,2888,179],function(){return e(e.s=89959)}),_N_E=e.O()}]);
//# sourceMappingURL=messages-95eb708fc7513c3b.js.map
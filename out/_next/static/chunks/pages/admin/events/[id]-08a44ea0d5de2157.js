(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3298],{35758:function(e,l,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/events/[id]",function(){return i(61093)}])},61093:function(e,l,i){"use strict";i.r(l),i.d(l,{default:function(){return L}});var t=i(85893),n=i(67294),a=i(84714),r=i(51750),s=i(99226),c=i(86886),o=i(46901),d=i(61903),u=i(87109),m=i(15861),h=i(50480),g=i(72852),x=i(83321),p=i(12899),j=i(72428),b=i(5299),Z=i(9763),f=i(33506),v=i(89261),k=i(33909),w=i(11163),y=i(81965),U=i(14106),P=i(42409),R=i(50356),T=i(65442);function L(){let e=(0,w.useRouter)(),l=e.query.id,{events:i,setEvents:L,get:C}=(0,a.h)(),[E,I]=(0,n.useState)({id:"",designMyNightId:"",title:"",description:null,dateTime:null,venue:"",venueAddress:"",venueDescription:"",ticketPrice:"",menAvailableTickets:"",womenAvailableTickets:"",ageRangeFrom:"",ageRangeTo:"",featured:!1,archived:!1,showBanner:!1,banner:"",imgURL:null,imgMobileUrl:null,participants:[],discountCodes:[{percent:10,code:(0,Z.Y)()},{percent:15,code:(0,Z.Y)()},{percent:20,code:(0,Z.Y)()}],howItWorks:{col1:{imgURL:null,description:null},col2:{imgURL:null,description:null},col3:{imgURL:null,description:null},finalNotes:null}}),[W,A]=(0,n.useState)(null),[D,S]=(0,n.useState)(null),[_,B]=(0,n.useState)(null),[M,N]=(0,n.useState)(!1),[F,V]=(0,n.useState)(E),[O,G]=(0,n.useState)(!1);(0,n.useEffect)(()=>{l&&(G(!0),(0,P.EY)(l).then(e=>{console.log(e),I({...e,dateTime:new Date(e.datetime)}),G(!1)}))},[l]);let Y=(0,n.useCallback)(e=>{I({...E,dateTime:e?new Date(e):null})},[E]),q=(0,n.useCallback)((e,l)=>I(e=>({...e,featured:l})),[]),H=(0,n.useCallback)((e,l)=>I(e=>({...e,isSameGender:l})),[]),K=(0,n.useCallback)((e,l)=>I(e=>({...e,archived:l})),[]),X=(0,n.useCallback)((e,l)=>I(e=>({...e,showBanner:l})),[]),z=(0,n.useCallback)(e=>{let{target:{name:l,value:i,type:t}}=e;"number"===t&&i&&(i=Number(i))<0||I({...E,[l]:i})},[E]),J=(0,n.useCallback)(e=>{let{target:{files:l}}=e;if(l&&l.length){let e=l[0];if(!(0,T.e)(e))return I(e=>({...e,imgURL:null})),S(null),scrollTop(),A("Invalid image file type!");W&&A(null),S(e),I(l=>({...l,imgURL:URL.createObjectURL(e)}))}},[W]),Q=(0,n.useCallback)(e=>{let{target:{files:l}}=e;if(l&&l.length){let e=l[0];if(!(0,T.e)(e))return I(e=>({...e,imgMobileUrl:null})),B(null),scrollTop(),A("Invalid image file type!");W&&A(null),B(e),I(l=>({...l,imgMobileUrl:URL.createObjectURL(e)}))}},[W]),$=(0,n.useCallback)(e=>{e.preventDefault(),URL.revokeObjectURL(D),document.querySelector("#file-input-desktop").value="",I(e=>({...e,imgURL:null})),S(null)},[D]),ee=(0,n.useCallback)(e=>{e.preventDefault(),URL.revokeObjectURL(_),document.querySelector("#file-input-mobile").value="",I(e=>({...e,imgMobileUrl:null})),B(null)},[_]),el=(0,n.useCallback)(async()=>{let e=E.howItWorks.col1;if(e.imgURL&&e.imgURL!==F.howItWorks.col1.imgURL){let l=await fetch(e.imgURL).then(e=>e.blob()),i=new File([l],"untitled",{type:l.type});e.imgURL=await (await uploadFile(i,HOW_IT_WORKS_IMAGES_PATH)).ref.getDownloadURL()}let l=E.howItWorks.col2;if(l.imgURL&&l.imgURL!==F.howItWorks.col2.imgURL){let e=await fetch(l.imgURL).then(e=>e.blob()),i=new File([e],"untitled",{type:e.type});l.imgURL=await (await uploadFile(i,HOW_IT_WORKS_IMAGES_PATH)).ref.getDownloadURL()}let i=E.howItWorks.col3;if(i.imgURL&&i.imgURL!==F.howItWorks.col3.imgURL){let e=await fetch(i.imgURL).then(e=>e.blob()),l=new File([e],"untitled",{type:e.type});i.imgURL=await (await uploadFile(l,HOW_IT_WORKS_IMAGES_PATH)).ref.getDownloadURL()}},[E.howItWorks,F.howItWorks]),ei=(0,n.useCallback)(()=>{if(!(F.participants.every(e=>E.participants.find(l=>l.email===e.email))&&F.participants.length===E.participants.length)){let e=F.participants.filter(e=>"M"===e.gender),l=E.participants.filter(e=>"M"===e.gender);e.length>l.length&&(E.menAvailableTickets+=e.length-l.length);let i=F.participants.filter(e=>"F"===e.gender),t=E.participants.filter(e=>"F"===e.gender);i.length>t.length&&(E.womenAvailableTickets+=i.length-t.length)}},[E,F.participants]),et=(0,n.useCallback)(async e=>{e.preventDefault(),W&&A(null);let t=E.participants.filter(e=>e.invitation===PENDING),n=t.filter(e=>"M"===e.gender),a=t.filter(e=>"F"===e.gender);if(t.length&&(n.length>E.menAvailableTickets||a.length>E.womenAvailableTickets))return A("Not enough available tickets for the pending invitations!"),scrollTop();N(!0);try{await el();let e=E.imgURL!==F.imgURL,r=e?D?await (await uploadFile(D,EVENTS_IMAGES_PATH)).ref.getDownloadURL():null:E.imgURL,s=E.imgMobileUrl!==F.imgMobileUrl,c=s?_?await (await uploadFile(_,EVENTS_IMAGES_PATH)).ref.getDownloadURL():null:E.imgMobileUrl;ei();let o={...E,imgURL:r,imgMobileUrl:c};if(await updateEvent(o),e&&F.imgURL)try{await deleteFileFromURL(F.imgURL)}catch(e){console.log(e.message)}let d=i.map(e=>e.id===l?o:e);if(L(d),t.length){let e=await (0,P.EY)(l);if(n.length>e.menAvailableTickets||a.length>e.womenAvailableTickets)return A("Not enough available tickets for the pending invitations!"),I({...E,menAvailableTickets:e.menAvailableTickets,womenAvailableTickets:e.womenAvailableTickets}),scrollTop();await addUsersToEvent(t,l)}return history.replace(routes.adminEvents)}catch(e){A(e.message),scrollTop()}N(!1)},[W,E,i,l,D,_,el,L,F.imgURL,ei]),en=(0,n.useCallback)(e=>{I(l=>({...l,description:e}))},[]),ea=(0,n.useCallback)(e=>{I(l=>({...l,venueDescription:e}))},[]),er=(0,n.useCallback)(e=>{I({...E,participants:e})},[E]),es=(0,n.useCallback)(e=>I({...E,howItWorks:e}),[E]);return(0,t.jsxs)(r.default,{children:[(M||O)&&(0,t.jsx)(R.Z,{}),!O&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("h2",{children:"Event Details"}),(0,t.jsx)(s.Z,{mt:2,mb:2,children:(0,t.jsxs)("form",{onSubmit:et,children:[(0,t.jsxs)(c.ZP,{container:!0,justifyContent:"space-between",spacing:2,children:[(0,t.jsxs)(c.ZP,{item:!0,container:!0,direction:"column",sm:6,spacing:2,children:[W&&(0,t.jsx)(c.ZP,{item:!0,children:(0,t.jsx)(o.Z,{severity:"error",children:W})}),l&&(0,t.jsx)(c.ZP,{item:!0,children:(0,t.jsx)(d.Z,{value:l,name:"id",fullWidth:!0,variant:"outlined",label:"Event ID",disabled:!0})}),(0,t.jsx)(c.ZP,{item:!0,children:(0,t.jsx)(d.Z,{defaultValue:E.title,name:"title",fullWidth:!0,variant:"outlined",label:"Event Title",required:!0,onBlur:z})}),(0,t.jsx)(c.ZP,{item:!0,children:(0,t.jsx)(p.x,{name:"dateTime",fullWidth:!0,value:E.dateTime,onChange:Y,label:"Event Date and Time",clearable:!0,inputVariant:"outlined",required:!0})}),(0,t.jsx)(c.ZP,{item:!0,children:(0,t.jsx)(d.Z,{defaultValue:E.designMyNightId,name:"designMyNightId",fullWidth:!0,variant:"outlined",label:"Design My Night Event ID",onBlur:z})}),(0,t.jsx)(c.ZP,{item:!0,children:(0,t.jsx)(d.Z,{InputProps:{startAdornment:(0,t.jsx)(u.Z,{position:"start",children:"\xa3"}),inputProps:{min:0}},name:"ticketPrice",type:"number",fullWidth:!0,variant:"outlined",label:"Ticket Price",defaultValue:E.ticketPrice,onBlur:z})}),(0,t.jsx)(c.ZP,{item:!0,children:(0,t.jsx)(d.Z,{InputProps:{startAdornment:(0,t.jsx)(u.Z,{position:"start",children:"\xa3"}),inputProps:{min:0}},name:"ticketPriceWithoutDiscount",type:"number",fullWidth:!0,variant:"outlined",label:"Ticket Price Without Discount",defaultValue:E.ticketPriceWithoutDiscount,onBlur:z})}),(0,t.jsx)(c.ZP,{item:!0,children:(0,t.jsxs)(s.Z,{display:"flex",alignItems:"center",children:[(0,t.jsx)(m.Z,{tag:"h4",children:"Same Gender event?"}),(0,t.jsx)(s.Z,{ml:4,children:(0,t.jsx)(h.Z,{name:"isSameGender",label:E.isSameGender?"YES":"NO",labelPlacement:"end",checked:E.isSameGender,control:(0,t.jsx)(g.Z,{color:"primary",title:"Same Gender"}),onChange:H})})]})}),(0,t.jsx)(c.ZP,{item:!0,children:(0,t.jsx)("h4",{children:"Available Tickets"})}),(0,t.jsxs)(c.ZP,{item:!0,container:!0,children:[(0,t.jsx)(c.ZP,{item:!0,xs:5,children:(0,t.jsx)(d.Z,{name:"menAvailableTickets",fullWidth:!0,variant:"outlined",label:"Men",type:"number",defaultValue:E.menAvailableTickets,required:!0,onBlur:z})}),(0,t.jsx)(c.ZP,{item:!0,container:!0,alignItems:"center",justifyContent:"center",xs:2,children:(0,t.jsx)("h4",{children:(0,t.jsx)(j.Z,{})})}),(0,t.jsx)(c.ZP,{item:!0,xs:5,children:(0,t.jsx)(d.Z,{name:"womenAvailableTickets",fullWidth:!0,variant:"outlined",label:"Women",type:"number",defaultValue:E.womenAvailableTickets,required:!0,onBlur:z})})]}),(0,t.jsx)(c.ZP,{item:!0,children:(0,t.jsx)("h4",{children:"Age Range"})}),(0,t.jsxs)(c.ZP,{item:!0,container:!0,children:[(0,t.jsx)(c.ZP,{item:!0,xs:5,children:(0,t.jsx)(d.Z,{name:"ageRangeFrom",fullWidth:!0,variant:"outlined",label:"From",type:"number",defaultValue:E.ageRangeFrom,onBlur:z})}),(0,t.jsx)(c.ZP,{item:!0,container:!0,alignItems:"center",justifyContent:"center",xs:2,children:(0,t.jsx)(b.Z,{})}),(0,t.jsx)(c.ZP,{item:!0,xs:5,children:(0,t.jsx)(d.Z,{name:"ageRangeTo",fullWidth:!0,variant:"outlined",label:"To",type:"number",defaultValue:E.ageRangeTo,onBlur:z})})]}),(0,t.jsx)(c.ZP,{item:!0,display:{sm:"none",xs:"block"},children:(0,t.jsx)(f.Z,{id:"file-input",onDelete:$,onUpload:J,imgURL:E.imgURL})})]}),(0,t.jsxs)(c.ZP,{item:!0,sm:6,display:{sm:"block",xs:"none"},children:[(0,t.jsxs)(s.Z,{children:[(0,t.jsx)("h4",{style:{marginBottom:"4px"},children:"Desktop Image (min 900 px width)"}),(0,t.jsx)(f.Z,{id:"file-input-desktop",onDelete:$,onUpload:J,imgURL:E.imgURL})]}),(0,t.jsxs)(s.Z,{style:{marginTop:"20px"},children:[(0,t.jsx)("h4",{style:{marginBottom:"4px"},children:"Mobile Image (max 440 px width)"}),(0,t.jsx)(f.Z,{id:"file-input-mobile",onDelete:ee,onUpload:Q,imgURL:E.imgMobileUrl})]})]})]}),(0,t.jsx)(s.Z,{my:4,children:(0,t.jsxs)(c.ZP,{container:!0,spacing:4,children:[(0,t.jsxs)(c.ZP,{item:!0,md:6,children:[(0,t.jsx)(s.Z,{children:(0,t.jsx)(d.Z,{name:"venue",fullWidth:!0,variant:"outlined",label:"Venue",defaultValue:E.venue,required:!0,onBlur:z})}),(0,t.jsx)(s.Z,{mt:3,children:(0,t.jsx)(d.Z,{name:"venueAddress",fullWidth:!0,variant:"outlined",label:"Venue Address",defaultValue:E.venueAddress,onBlur:z})})]}),(0,t.jsxs)(c.ZP,{item:!0,md:6,children:[(0,t.jsx)(s.Z,{py:2,children:(0,t.jsx)("h4",{children:"Venue Description"})}),(0,t.jsx)(v.Z,{description:(0,k.E)(E.venueDescription),onChange:ea,placeholder:"Venue Description"})]})]})}),(0,t.jsx)(s.Z,{my:4,children:(0,t.jsxs)(c.ZP,{container:!0,alignItems:"center",children:[(0,t.jsx)(c.ZP,{item:!0,sm:4,children:(0,t.jsxs)(s.Z,{display:"flex",alignItems:"center",children:[(0,t.jsx)(m.Z,{tag:"h4",children:"Featured Event?"}),(0,t.jsx)(s.Z,{ml:4,children:(0,t.jsx)(h.Z,{name:"featured",label:E.featured?"YES":"NO",labelPlacement:"end",checked:E.featured,control:(0,t.jsx)(g.Z,{color:"primary",title:"Featured Event"}),onChange:q})})]})}),(0,t.jsx)(c.ZP,{item:!0,sm:4,children:(0,t.jsxs)(s.Z,{display:"flex",alignItems:"center",children:[(0,t.jsx)(m.Z,{tag:"h4",color:"primary",children:"Archived Event?"}),(0,t.jsx)(s.Z,{ml:4,children:(0,t.jsx)(h.Z,{name:"archived",label:E.archived?"YES":"NO",labelPlacement:"end",checked:E.archived,control:(0,t.jsx)(g.Z,{color:"primary",title:"Archived Event"}),onChange:K})})]})}),(0,t.jsx)(c.ZP,{item:!0,sm:4,children:(0,t.jsxs)(s.Z,{display:"flex",alignItems:"center",children:[(0,t.jsx)(m.Z,{tag:"h4",color:"primary",children:"Discounts"}),(0,t.jsx)(s.Z,{ml:2,children:E.discountCodes.map((e,l)=>(0,t.jsx)(s.Z,{mt:1,children:(0,t.jsx)(d.Z,{name:"discountCode",fullWidth:!0,variant:"outlined",label:"Discount Code(".concat(e.percent," %)"),defaultValue:e.code,onBlur:e=>handleDiscountChange(e.target.value,l)})},l))})]})})]})}),(0,t.jsx)(s.Z,{my:4,children:(0,t.jsxs)(c.ZP,{container:!0,alignItems:"center",children:[(0,t.jsx)(c.ZP,{item:!0,sm:4,children:(0,t.jsxs)(s.Z,{display:"flex",alignItems:"center",children:[(0,t.jsx)(m.Z,{tag:"h4",children:"Show Banner?"}),(0,t.jsx)(s.Z,{ml:4,children:(0,t.jsx)(h.Z,{name:"showBanner",label:E.showBanner?"YES":"NO",labelPlacement:"end",checked:E.showBanner,control:(0,t.jsx)(g.Z,{color:"primary",title:"Show Banner"}),onChange:X})})]})}),(0,t.jsx)(c.ZP,{item:!0,sm:8,children:(0,t.jsx)(d.Z,{name:"banner",fullWidth:!0,variant:"outlined",label:"Banner",type:"text",defaultValue:E.banner,onBlur:z})})]})}),(0,t.jsxs)(s.Z,{my:4,children:[(0,t.jsx)(s.Z,{py:2,children:(0,t.jsx)("h4",{children:"Event Description"})}),(0,t.jsx)(v.Z,{description:(0,k.E)(E.description),onChange:en})]}),(0,t.jsx)(s.Z,{my:4,children:(0,t.jsx)(y.Z,{howItWorks:E.howItWorks,onChange:es,setError:A,error:W})}),(0,t.jsx)(s.Z,{my:4,children:(0,t.jsx)(U.Z,{participants:E.participants,onChange:er,disabled:!1})}),(0,t.jsx)(s.Z,{my:4,children:(0,t.jsxs)(c.ZP,{container:!0,spacing:2,justifyContent:"flex-end",children:[(0,t.jsx)(c.ZP,{item:!0,xs:6,sm:4,md:3,children:(0,t.jsx)(x.Z,{fullWidth:!0,onClick:()=>e.push(routes.adminEvents),type:"button",color:"secondary",variant:"contained",children:"Cancel"})}),(0,t.jsx)(c.ZP,{item:!0,xs:6,sm:4,md:3,children:(0,t.jsx)(x.Z,{fullWidth:!0,disabled:M||O,type:"submit",color:"primary",variant:"contained",children:"Create Event"})})]})})]})})]})]})}}},function(e){e.O(0,[1903,7579,935,4654,6023,8070,3168,8527,9774,2888,179],function(){return e(e.s=35758)}),_N_E=e.O()}]);
//# sourceMappingURL=[id]-08a44ea0d5de2157.js.map